# **Система заказов по покупке билетов**
## **Манушкина Анастасия, БПИ 223-1**
### Запуск
Чтобы поднять докер, можно просто запустить bash-скрипт, вставив в терминал команду `./startup`  
Если это по какой-то причине не сработало (хотя обязано), можно создать файл с этим bash-скриптом по новой, вставив туда этот код, и запустить этот файл
```
#!/bin/bash  
cd ./AuthService  
./mvnw clean package  
cd ../OrderService  
./mvnw clean package  
cd ..  
docker-compose up --build --detach
```
### Тестирование
Протестировать микросервисы можно с помощью swagger-ui

**Микросервис авторизации**

Чтобы попасть в swagger, нужно вставить в поисковую строку браузера `http://localhost:8080/swagger-ui/index.html#/`  
Чтобы посмотреть на базу данных, необходимо в поисковую строку браузера вставить `http://localhost:8080/h2-console/`  
`JDBC URL:` jdbc:h2:file:./resources/db    
`User Name:` admin  
`Password:` admin  
Далее нужно нажать `Connect`, после чего откроется база данных с двумя таблицами: `USERS_TABLE`, в которой будут появляться зарегистрированные пользователи, и `SESSIONS`, в которой будут появляться сессии авторизованных пользователей  
Реализовано три ручки: регистрация, авторизация и получение информации об авторизованном пользователе. Ниже подробнее о каждой ручке  
**Регистрация (/auth/register)**  
В теле запроса необходимо передать электронную почту (важно, чтобы она содержала символы '@' и '.', и при этом точка стояла после собаки), никнейм и пароль (должен состоять из >=8 символов и содержать заглавные и строчные *латинские* буквы, цифры и специальные символы)  
Если все требования выполнены, регистрация прошла успешно и пользователь появляется в базе данных  
**Авторизация (/auth/login)**  
В теле запроса необходимо передать электронную почту и пароль (важно до этого зарегистрироваться с этими данными)  
Если авторизация прошла успешно, сервис выдает сообщение, в котором также содержится токен. Токен необходимо скопировать для того, чтобы протестировать последнюю ручку и, в ближайшем будущем, сервис заказов  
*Токен действителен ровно 1 час с момента авторизации*  
**Получение информации об авторизованном пользователе (/auth/user)**  
Необходимо передать токен, полученный при авторизации  
Сервис выдает информацию о пользователе с таким токеном: айди, никнейм, электронная почта, зашифрованный пароль и дата регистрации

**Микросервис заказов**

Чтобы попасть в swagger, нужно вставить в поисковую строку браузера `http://localhost:8082/swagger-ui/index.html#`  
Чтобы посмотреть на базу данных, необходимо в поисковую строку браузера вставить `http://localhost:8082/h2-console/`  
`JDBC URL:` jdbc:h2:file:./resources/db  
`User name:` admin  
`Password:` admin
После нажатия `Connect`, открывается база данных с двумя таблицами: `ORDER_TABLE`, в которой будут появляться созданные заказы, и `STATION` для хранения станций  
**Важно!** Перед тестированием микросервиса для заказов билетов, необходимо вставить станции с таблицу `STATION` с помощью SQL-запроса `INSERT INTO "STATION" (station) VALUES ('Moscow'), ('Saint-Petersburg'), ('Samara'), ('Erevan')`  
Можно навыдумывать свои города и вставить их :)  
Реализованы две ручки: создание заказа и получение информации о созданном заказе  
**Создание заказа (/order)**  
В теле запроса необходимо передать два названия станций, существующих в таблице STATION  
Также в качестве параметра нужно передать токен, полученный при авторизации в первом микросервисе  
При успешном создании заказа сервис выдает информацию о нем: айди заказа, айди пользователя, станция отправления, станция прибытия, статус и дата создания заказа  
Эти данные записываются в таблицу в бд  
**Получение информации о созданном заказе (/order/{id})**  
В качестве параметра необходимо передать айди заказа  
Сервис отобразит ту же информацию, что при создании заказа, но с обновленным статусом (статус меняется через 10 секунд после создания заказа)
### Примечание
Пока я делала это дз, я очень сильно старалась и испытала огромное количество совершенно разных эмоций (от полного отчаяния и потери всякой веры в то, что я вообще с этим справлюсь, до невероятной радости от того, что у меня что-то заработало или починилось)  
Последнюю неделю я жила исключительно мыслями об этом проекте: я засыпала с ним; просыпалась с ним; все свое свободное время, в том числе то, которое планировалось отвести на полноценный здоровый сон или отдых, я посвятила разработке двух этих микросервисов. Я пересоздавала проект 8 раз (возможно, больше, просто сбилась со счета), переписывала все с нуля, безуспешно чинила предыдущие версии, меняла базы данных с postgres на H2 и языки программирования с Kotlin на Java и обратно. Проект кидался в меня огромным разнообразием ошибок и исключений, а гит категорически отказывался делать мне пулл-реквест, но я не сдавалась  
Я прошла через огонь и воду с этим домашним заданием, чтобы, наконец, справиться и выдать через боль, кровь, пот и слезы что-то действительно красивое и, главное, *работающее*